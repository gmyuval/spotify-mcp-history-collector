{% extends "base.html" %}
{% block title %}Imports{% endblock %}
{% block content %}
<h2 class="mb-4">Import Jobs</h2>

<!-- Upload form -->
<div class="card mb-4">
  <div class="card-header"><strong>Upload ZIP Import</strong></div>
  <div class="card-body">
    <form hx-post="/imports/upload"
          hx-encoding="multipart/form-data"
          hx-target="#upload-result"
          hx-swap="innerHTML"
          class="row g-2 align-items-end">
      <div class="col-auto">
        <label class="form-label">User</label>
        <select name="user_id" class="form-select form-select-sm" required>
          <option value="">Select user...</option>
          {% for user in users %}
          <option value="{{ user.id }}">{{ user.display_name or user.spotify_user_id }} ({{ user.id }})</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-auto">
        <label class="form-label">ZIP File</label>
        <input type="file" name="file" accept=".zip" class="form-control form-control-sm" required>
      </div>
      <div class="col-auto">
        <button type="submit" class="btn btn-primary btn-sm">Upload</button>
      </div>
    </form>
    <div id="upload-result" class="mt-2"></div>
  </div>
</div>

<!-- Filters -->
<form hx-get="/imports/partials/imports-table"
      hx-target="#imports-tbody"
      hx-swap="innerHTML"
      hx-trigger="change from:select, keyup changed delay:500ms from:input"
      class="row g-2 mb-3">
  <div class="col-auto">
    <select name="status" class="form-select form-select-sm">
      <option value="">All statuses</option>
      <option value="pending" {% if status == "pending" %}selected{% endif %}>pending</option>
      <option value="processing" {% if status == "processing" %}selected{% endif %}>processing</option>
      <option value="success" {% if status == "success" %}selected{% endif %}>success</option>
      <option value="error" {% if status == "error" %}selected{% endif %}>error</option>
    </select>
  </div>
  <div class="col-auto">
    <input type="text" name="user_id" class="form-control form-control-sm"
           placeholder="User ID" value="{{ user_id | default('') }}">
  </div>
</form>

<div class="card">
  <div class="card-body p-0">
    <table class="table table-striped table-hover mb-0">
      <thead>
        <tr>
          <th>ID</th><th>User</th><th>Status</th><th>Format</th>
          <th>Records</th><th>Date Range</th><th>Created</th><th>Error</th>
        </tr>
      </thead>
      <tbody id="imports-tbody">
        {% include "partials/_imports_table.html" %}
      </tbody>
    </table>
  </div>
</div>

<div id="imports-pagination" class="mt-3">
  {% if total > limit %}
  {% with url="/imports/partials/imports-table", target="#imports-tbody" %}
  {% include "partials/_pagination.html" %}
  {% endwith %}
  {% endif %}
</div>
{% endblock %}
