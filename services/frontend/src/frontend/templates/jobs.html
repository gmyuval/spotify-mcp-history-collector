{% extends "base.html" %}
{% block title %}Job Runs{% endblock %}
{% block content %}
<h2 class="mb-4">Job Runs</h2>

<!-- Filters -->
<form hx-get="{{ base_path }}/jobs/partials/jobs-table"
      hx-target="#jobs-tbody"
      hx-swap="innerHTML"
      hx-trigger="change from:select, keyup changed delay:500ms from:input"
      class="row g-2 mb-3">
  <div class="col-auto">
    <select name="job_type" class="form-select form-select-sm">
      <option value="">All types</option>
      <option value="poll" {% if job_type == "poll" %}selected{% endif %}>poll</option>
      <option value="initial_sync" {% if job_type == "initial_sync" %}selected{% endif %}>initial_sync</option>
      <option value="import_zip" {% if job_type == "import_zip" %}selected{% endif %}>import_zip</option>
      <option value="enrich" {% if job_type == "enrich" %}selected{% endif %}>enrich</option>
    </select>
  </div>
  <div class="col-auto">
    <select name="status" class="form-select form-select-sm">
      <option value="">All statuses</option>
      <option value="running" {% if status == "running" %}selected{% endif %}>running</option>
      <option value="success" {% if status == "success" %}selected{% endif %}>success</option>
      <option value="error" {% if status == "error" %}selected{% endif %}>error</option>
    </select>
  </div>
  <div class="col-auto">
    <input type="text" name="user_id" class="form-control form-control-sm"
           placeholder="User ID" value="{{ user_id | default('') }}">
  </div>
</form>

<div class="card">
  <div class="card-body p-0">
    <table class="table table-striped table-hover mb-0">
      <thead>
        <tr>
          <th>ID</th><th>User</th><th>Type</th><th>Status</th>
          <th>Fetched</th><th>Inserted</th><th>Skipped</th>
          <th>Started</th><th>Completed</th><th>Error</th>
        </tr>
      </thead>
      <tbody id="jobs-tbody">
        {% include "partials/_jobs_table.html" %}
      </tbody>
    </table>
  </div>
</div>

<div id="jobs-pagination" class="mt-3">
  {% if total > limit %}
  {% with url=base_path ~ "/jobs/partials/jobs-table", target="#jobs-tbody" %}
  {% include "partials/_pagination.html" %}
  {% endwith %}
  {% endif %}
</div>
{% endblock %}
